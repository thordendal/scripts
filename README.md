
# logstat.py
Скрипт считает количество строк, которые соответствуют регулярному выражению, при этом читая только новые строки в файле, т.е. не перечитывая файл с нуля.  

## Требования
`python2`

## Usage
```bash
./logstat.py /path/to/logfile.log REGEX [/path/to/stat_file.json]
```
Путь к файлу состояний является опциональным, если он не указан, то будет использован путь `/home/zabbix/scripts/log_state.json`


## Описание работы на примере
```bash
# Запускаем впервые:
$ ./logstat.py /var/log/foo.log 'Fatal error'
10
# Предположим, что /var/log/foo.log не изменился и не ротировался. Запустим ещё раз:
$ ./logstat.py /var/log/foo.log 'Fatal error'
0
# А вот теперь в файле foo.log появятся две строки с Fatal error
$ ./logstat.py /var/log/foo.log 'Fatal error'
2
```
При первом запуске скрипта на файл `/var/log/foobar.log` с регэкспом `Fatal error` скрипт будет прочтён с самой первой строки.  
При втором запуске скрипт проверит, был ли изменён файл:  
Если в файл были дописаны строки, то будут прочитаны только новые строки.  
Если файл был ротирован, то файл будет прочитан сначала.  
При этом если запустить скрипт на тот же файл, но с другим регэкспом впервые, то чтение также будет происходить с начала файла, что позволяет мониторить один и тот же файл по нескольким регэкспам.
